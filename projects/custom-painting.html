<iframe id="loadingScreen" src="/loading" style="position: fixed; width: 100vw; height: 100vh; z-index: 50; background-color: white;"></iframe>
<!DOCTYPE html>
<html>
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6164958056874648" crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="/assets/media/favicon.ico">
    <meta property="og:title" content="Project: Head Decoration">
    <meta property="og:image" content="https://blockstate.team/assets/media/project-logo/customPainting.webp">
    <meta charset="UTF-8" />
    <title>Project: Custom Painting</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="custom-painting.css" rel="stylesheet" type="text/css">
    <script src="./custom-painting.js" defer type="module"></script>
    <script>
        window.onload = function () {
            const menu_btn = document.querySelector('.hamburger');
            const mobile_menu = document.querySelector('.mobile-nav');
            menu_btn.addEventListener('click', function () {
                menu_btn.classList.toggle('is-active');
                mobile_menu.classList.toggle('is-active');
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('hoverVideo');
            video.pause();
            video.addEventListener('mouseover', () => {
                video.play();
            });
            video.addEventListener('mouseout', () => {
                video.pause();
                video.currentTime = 0;
            });
        });
        window.addEventListener("load", () => {
        const loadingScreen = document.getElementById("loadingScreen");
        const fadeDuration = 1000; // 1 second
        const intervalTime = fadeDuration / 50;

        loadingScreen.style.opacity = "1";

        setTimeout(() => {
            const fadeOutStep = () => {
                const currentOpacity = parseFloat(loadingScreen.style.opacity) - (1 / 50);
                loadingScreen.style.opacity = currentOpacity;

                if (currentOpacity <= 0) {
                    loadingScreen.style.visibility = "hidden";
                    clearInterval(fadeInterval);
                }
            };
            const fadeInterval = setInterval(fadeOutStep, intervalTime);
            }, 1000);
        });
    </script>
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3449C7QP0C"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-3449C7QP0C');
</script>
<body>
    <div class="topnav" id="myTopnav">
		<img src="/assets/media/ConvertToSVG.webp" class="hidden" style="height: 8vh; position:fixed; margin-top: 1.5vh; margin-left: 1vw;">
		<video id="hoverVideo" src="https://dl.dropboxusercontent.com/scl/fi/xudtox8mmlvh57rmbprku/logo.webm?rlkey=r31es7ksq7megly241ocx7see&dl=0" class="hidden" type="video/webm" style="z-index: 40; height: 3.5vw; position: fixed; margin-left: 3.6vw;" muted loop></video>
		<nav id="desktopNav">
			<a href="/project" class="active">Project</a>
            <a href="/announcement">announcement</a>
			<a href="/contact">Contact</a>
			<a href="/our_story">Our Story</a>
			<a href="/">Home</a>
		</nav>
		<button class="hamburger">
			<div class="bar"></div>
		</button>
		<div class="mobile-nav">
			<a href="/">Home</a>
			<a href="/our_story">Our Story</a>
			<a href="/contact">Contact</a>
            <a href="/announcement">announcement</a>
			<a href="/project" class="active">Project</a>
		</div>
	</div>
    <h2>Project: Custom Painting</h2>
    <div id="content">
        <div class="section" style="text-align: left;">    
            Presenting Head Decorations! You now have the option to select from a variety of head blocks and seamlessly incorporate them into your game, much like in the Java Edition, but now accessible in Minecraft Bedrock Edition.
        </div>
        <img src="../assets/media/head-decoration/1.webp">
        <div class="section">
            To get the heads, just use /give command! All the heads share the same spacename head_system, so you can use /give @s head_system:head_name to get your decoration head!
        </div>
        <img src="../assets/media/head-decoration/2.webp">
        <div class="section">
            Here's the heads in-game! Amazing isn't it?
        </div>
        <h2 id="credit">CREDIT TO minecraft-heads.com</h2>
        <div class="section" style="text-align: left;">    
            Before proceeding further, our gratitude goes out to minecraft-heads.com for providing the exceptional API that fuels this Add-On.
            <br> Thank you!
        </div>
        <img src="../assets/media/head-decoration/credit.webp">
    </div>
    <h2>HELP SECTION</h2>
    <div class="section">
        If you need any help, feel free to join our Discord!
        <div style="width: 100vw; height: 15vh; display: flex; justify-content: center;">
            <a href="https://discord.gg/p3FvBh2aBd">
                <button class="genericButton">Discord</button>
            </a>
        </div>
    </div>
    <h2>BUILD YOUR ADDON SECTION</h2>
    <div class="section" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div style="width: 80vw; display: flex; flex-direction: row; align-items: center; justify-content: space-evenly; ">
            <button class="genericButton" id="addNewPaintingButton">Add new painting</button>
            with size:
            <select id="sizeSelector">
                <option value="1x1x0">1 x 1</option>
                <option value="1x2x1">1 x 2</option>
                <option value="2x1x2">2 x 1</option>
                <option value="2x2x3">2 x 2</option>
                <option value="4x2x4">4 x 2</option>
                <option value="4x4x5">4 x 4</option>
            </select>
        </div>
        <canvas id="myCanvas" width="256" height="256" style="display: none;"></canvas>
        <table id="displayTable">
            <tr><td>Upload picture</td></tr>
        </table>
    </div>
    <script>
        function positionCalc(indexOption, emptySlotIndex) {
            let result = [];
            if (indexOption === 0) {
                emptySlotIndex < 5 ? result = [112 + emptySlotIndex * 16, 0] : result = [(emptySlotIndex - 5) * 16, 16];
            } else if (indexOption === 1) {
                result = [32 + 16 * emptySlotIndex, 64];
            } else if (indexOption === 2) {
                emptySlotIndex === 0 ? result = [160, 32] : result = [32 * (emptySlotIndex - 1), 48];
            } else if (indexOption === 3) {
                result = [128 + 32 * emptySlotIndex, 160];
            } else if (indexOption === 4) {
                result = [64 + 64 * emptySlotIndex, 96];
            } else {
                result = [192, 192];
            }
            return result;
        }
        let painting = [
            [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], // 17 
            [[], [], [], [], [], [], [], [], [], []], // 10
            [[], [], [], [], [], [], []], // 7
            [[], [], [], []], //4
            [[], []], // 2
            [[]] // 1
        ];
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        const defaultImageSrc = '../assets/media/custom-painting/kz.png';
        const defaultImage = new Image();
        defaultImage.src = defaultImageSrc;
        defaultImage.onload = () => {
            ctx.drawImage(defaultImage, 0, 0, canvas.width, canvas.height);
        };
        document.getElementById('addNewPaintingButton').addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.png';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);
            fileInput.click();

            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file && file.type === 'image/png') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            let indexOption = +document.getElementById('sizeSelector').value.split('x')[2];
                            let isEmptySlot = false;
                            let emptySlotIndex = 0;
                            for (let i = 0; i < painting[indexOption].length; i++) {
                                if (painting[indexOption][i].length === 0) {
                                    isEmptySlot = true;
                                    emptySlotIndex = i;
                                    break;
                                }
                            }
                            if (!isEmptySlot) {
                                alert('You have reached the maximum number of paintings for this size.');
                                return;
                            } else {
                                painting[indexOption][emptySlotIndex] = img;
                            }
                            document.getElementById('displayTable').innerHTML += `<tr><td><img src="${e.target.result}" style="width: 15vw;"></td></tr>`;
                            let expectedWidth = 16 * +document.getElementById('sizeSelector').value.split('x')[0];
                            let expectedHeight = 16 * +document.getElementById('sizeSelector').value.split('x')[1];
                            const aspectRatio = img.width / img.height;
                            const targetAspectRatio = expectedWidth / expectedHeight;
                            let sx, sy, sWidth, sHeight, dx, dy;
                            if (aspectRatio > targetAspectRatio) {
                                sHeight = img.height;
                                sWidth = img.height * targetAspectRatio;
                                sx = (img.width - sWidth) / 2;
                                sy = 0;
                            } else {
                                sWidth = img.width;
                                sHeight = img.width / targetAspectRatio;
                                sx = 0;
                                sy = (img.height - sHeight) / 2;
                            }
                            let offset = positionCalc(indexOption, emptySlotIndex);
                            ctx.imageSmoothingEnabled = false;
                            ctx.drawImage(img, sx, sy, sWidth, sHeight, offset[0], offset[1], expectedWidth, expectedHeight);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    console.error('Please upload a valid PNG file.');
                }
                document.body.removeChild(fileInput);
            });
        });
    </script>
    <h2>DOWNLOAD SECTION</h2>
    <div class="warning">
        WARNING:  This Addon requires Holiday Creator Features to work properly! 
    </div>
    <div class="downloadSection">
        <label for="tosCheckbox">
          <input type="checkbox" id="tosCheckbox">
          <span id="tosLabel">I <span style="text-decoration: underline;">disagree</span> to the <a href="../TOS" target="_blank">Term of service</a></span>
        </label><br>
        <div class="warning" id="errorWarningCompile" style="display: none;">
            WARNING: DUPLICATE WARNING! 
        </div>
        <button class="genericButton" id="genericButton" disabled>Download Now!</button>
    </div>
    <div class="compiler">
        <iframe src="../loading" style="width: 80vw; height: 95vh; background-color: white; border-radius: 2vw; z-index: 50;"></iframe>
    </div>
    <div id="loadingBar" class="compiler" style="background-color: black; height:20px; width:60vw; margin-left: 20vw; z-index: 51; top: 69vh; display: none;">
        <div id="loadingBarRun" style="background-color: magenta; width:0%; height: inherit; z-index: 52; position: relative; left: 0;"></div>
    </div>
    <div class="compiler" id="loadingText" style="max-width: 90vw; margin-left: 5vw; text-overflow: clip; font-size: 5vw; font-family: 'MinecraftTen'; z-index: 49; margin-top: 28vh; background-color: rgba(0, 0, 0, 0) !important;">
        LOADING...
    </div>

</body>
</html>