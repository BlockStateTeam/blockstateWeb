<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6164958056874648" crossorigin="anonymous"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="icon" type="image/x-icon" href="/assets/media/favicon.ico">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Our Story</title>
	<script>
		window.onload = function () {
		const menu_btn = document.querySelector('.hamburger');
		const mobile_menu = document.querySelector('.mobile-nav');

		menu_btn.addEventListener('click', function () {
			menu_btn.classList.toggle('is-active');
			mobile_menu.classList.toggle('is-active');
		});
	}
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('hoverVideo');
            video.pause();
            video.addEventListener('mouseover', () => {
                video.play();
            });
            video.addEventListener('mouseout', () => {
                video.pause();
                video.currentTime = 0;
            });
        });
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('isComment') === 'true') {
                window.scrollTo(0, document.body.scrollHeight);
            }
        });
	</script>
    <style>
        @font-face { font-family: MinecraftTen; src: url('/assets/fonts/MinecraftTen.woff'); } 
        @font-face { font-family: Minecraft; src: url('/assets/fonts/Minecraft.otf'); } 
        @font-face { font-family: MinecraftFive; src: url('/assets/fonts/MinecraftFive-Regular.woff2'); }

        body::-webkit-scrollbar {
            display: none;
        }
        #fakeLogo {
            position: fixed;
            height: 5vw;
            display: flex;
            align-items: center;
            margin-left: 5.5vw;
            font-family: 'MinecraftTen';
            font-size: 2vw;
            line-height: 0.85;
        }
        body {
            overflow-x: hidden;
            font-family: 'Minecraft';
            background-color: #F8ECEC;
            margin: 0;
        }
        .topnav {
            z-index: 30;
            background-color: #FFFFFF;
            height: 5vw;
            top: 0;
            position: -webkit-sticky;
            position: sticky;
        }

        .topnav a {
            font-family: 'MinecraftTen';
            float: right;
            display: block;
            color: #373097;
            text-align: center;
            padding: 1.2vw 1.5vw;
            text-decoration: none;
            font-size: 2vw;
            transition: 0.15s;
        }

        .topnav a:hover {
            background-color: #e9d3ff;
            color: #8000ff;
        }

        .topnav a.active {
            background-color: #4d009a;
            color: white;
        }

        .topnav .icon {
            display: none;
        }
        #mobileNav {
            display: none;
        }
        .hamburger {
            margin: 2vw;
            margin-left: 85vw;
            z-index: 200;
            display: none;
            position: fixed;
            width: 50px;
            cursor: pointer;
            appearance: none;
            background: none;
            outline: none;
            border: none;
        }
        .hamburger .bar, .hamburger:after, .hamburger:before {
            content: '';
            display: block;
            width: 100%;
            height: 5px;
            background-color: #4229B9;
            margin: 6px 0px;
            transition: 0.4s;
        }

        .hamburger.is-active:before {
            transform: rotate(-45deg) translate(-8px, 6px);
        }

        .hamburger.is-active:after {
            transform: rotate(45deg) translate(-9px, -8px);
        }

        .hamburger.is-active .bar {
            opacity: 0;
        }
        h2 {
            font-family: 'MinecraftTen';
            font-size: 3vw;
            margin-top: 5vh;
            margin-left: 10vw;
            margin-bottom: 6vh;
        }
        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            left: 100%;
            width: 100%;
            min-height: 100vh;
            background-color: white;
            padding-top: 120px;
            transition: 0.4s;
        }

        .mobile-nav.is-active {
            left: 0;
        }

        .mobile-nav a {
            display: block;
            width: 100%;
            max-width: 200px;
            margin: 0 auto 16px;
            text-align: center;
            padding: 12px 16px;
            text-decoration: none;
        }
        .hidden{
            height: 4.5vw;
        }
        .box {
            width: 35vw; 
            height: fit-content;
            overflow: hidden;
            background-color: white;
            box-sizing: border-box;
            border-radius: 10px;
            transition: 0.3s;
            margin-right: 5vw;
        }
        .box img{
            width: 35vw;
            height: auto;
            transition: 0.3s;
        }
        .box a{
            display: flex;
            height: fit-content;
        }
        .box:hover > a > img{
            width: 40vw;
        }
        .box:hover{
            width: 40vw;
        }
        .container {
            display: flex;
            row-gap: 5vh;
            flex-wrap: wrap;
            margin-left: 10vw;
            margin-top: 10vh;
            margin-bottom: 10vh;
            width: 90vw;
        }
        .knowSelect {
            margin-left: 10vw;
            font-family: 'Minecraft';
            z-index: 97;
            height: 5vh;
            font-size: 3.5vh;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-weight: bold;
        }
        #content{
            padding-left: 15vw;
            padding-right: 15vw;
        }
        #video{
            width: 70vw;
            height: 80vh
        }
        .section {
            letter-spacing: -0.1vw;
            line-height: 4.5vh;
            font-size: 1.5vw;
            padding-bottom: 8vh;
            text-align: center;
        }
        #content > img {
            border-radius: 20px;
            width: 70vw;
        }
        #content > video {
            border-radius: 20px;
            width: 70vw;
        }
        .section > iframe {
            border-radius: 20px;
            width: 70vw;
            height: 40vw;
        }
        .downloadSection{
            display: flex;
            width: 100vw;
            font-size: 2vw;
            letter-spacing: -0.15vw;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        input[type="checkbox"] {
            transform: scale(3) translateY(-1px);
            margin-right: 40px;
            appearance: none;
            border: 2px solid #4d009a;
            width: 20px;
            height: 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        input[type="checkbox"]:checked {
            content: "\2713";
            color: #fff;
            background-color: #4d009a;
            animation: checkboxPulse 0.4s;
        }
        input[type="checkbox"]:checked:after {
            content: "✓";
            color: #fff;
            position: absolute;
            left: 50%;
            top: 50%;
            -webkit-transform: translate(-50%,-50%);
            -moz-transform: translate(-50%,-50%);
            -ms-transform: translate(-50%,-50%);
            transform: translate(-50%,-50%);
        }
        .warning {
            color:red;
            letter-spacing: -1px;
            font-size: 1.5vw;
            width: 100vw;
            height: 10vh;
            text-align: center;
        }
        .compiler {
            display: none;
            width: 100vw; 
            height: 100vh; 
            background-color: rgba(0, 0, 0, 0.85); 
            position: fixed; 
            z-index: 48; 
            top: 0;
            align-items: center; 
            justify-content: center;
        }
        button:disabled {
            cursor: not-allowed;
            opacity: 0.2;
        }
        .genericButton {
            margin: 2.5vw;
            border: none;
            border-radius: 0.5vw;
            padding-left: 20px;
            padding-right: 20px;
            background-color: #4229B9;
            color: #FFFFFF;
            font-family: 'MinecraftTen';
            font-size: 3vw;
            transition: 0.25s;
        }
        .genericButton:hover {
            border-radius: 1vw;
            background-color: #1b0879;
            color: #fcf2ff;
        }
        .genericButton:active {
            border-radius: 1.5vw;
            background-color: #100546;
            transform: translate(10px,10px);
        }
        .buttonWrapper {
            width: 100vw; 
            height: 15vh; 
            display: flex; 
            justify-content: center;
        }
        #creditFormat {
            text-align: left; 
            padding-left: 10vw;
            width: 80vw;
        }
        #creditFormat > img {
            margin-left: 5vw;
            border-radius: 20px;
            width: 70vw;
        }
        #languageSwitcher {
            background-color: white;
            border-radius: 52%;
            z-index: 49;
            position: fixed;
            bottom: 2vh;
            right: 2vh;
            width: 5vw;
            height: 5vw;
            fill: black;
        }
        #languageDialog {
            background-color: #F8ECEC;
            padding: 2v;
            font-size: 2vw;
            user-select: none;
            font-family: 'MinecraftTen';
            border: none;
            border-radius: 1vw;
        }
        #languageDialog form > button {
            margin-left: 2vw;
            height: 7vh;
            width: 7vw;
            font-size: 2vw;
            font-family: 'Minecraft';
            border: none;
            border-radius: 0.5vw;
            background-color: #4229B9;
            color: white;
        }
        ::backdrop {
            background-color: black;
            opacity: 0.75;
        }
        #coffee {
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 50;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
        }
        #coffee > div {
            width: 70vw;
            height: 70vh;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            flex-direction: row;
            overflow: hidden;
        }
        #coffee > div > img {
            width: 35vw;
            height: 70vh;
            object-fit: cover;
        }
        #coffee > div > div {
            width: 35vw;
            height: 70vh;
            padding: 2.5vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-size: 1.75vw;
            font-family: 'Minecraft';
        }
        #closecoffee {
            position: absolute;
            top: 18vh;
            right: 17vw;
            width: 3vw;
            height: 3vw;
            fill: #4229B9;
        }
        @media (max-aspect-ratio: 3/4) {
            #languageDialog form > button {
                font-size: 2.5vh;
                margin-left: 12vw;
                height: 5vh;
                width: 17vw;
                border-radius: 2vw;
            }
            #languageDialog {
                font-size: 3.2vh;
                width: 90vw;
            }
            #languageSwitcher {
                bottom: 2vh;
                right: 2vh;
                width: 15vw;
                height: 15vw;
            }
            .warning {
                font-size: 2vh;
                height: 17vh;
            }
            .downloadSection{
                width: 90vw;
                margin-left: 5vw;
                margin-bottom: 5vh;
            }
            #fakeLogo {
                height: 15vw;
                margin-left: 16vw;
                font-size: 3vh;
                z-index: 40;
            }
            .hidden {
                height: 7vh;
            }
            .mobile-nav {
                display: flex;
                flex-direction: column;
            }
            .hamburger {
                display: block;
            }
            #desktopNav {
                display: none;
            }
            .topnav {
                height: 15vw;
            }
            .topnav a {
                padding: 4vw 2vw;
                font-size: 8vw;
            }
            h2 {
                margin-left: 5vw !important;
                font-size: 9vw !important;
                margin-top: 2vh !important;
                margin-bottom: 2vh !important;
            }
            .knowSelect {
                font-size: 2.2vh;
                height: 4vh;
            }
            .container {
                margin-top: 5vh !important;
                row-gap: 2.5vh !important;
            }
            .box {
                width: 80vw !important;
            }
            .box img{
                width: 80vw !important;
            }
            input[type="checkbox"] {
                margin-right: 20px;
                width: 15px;
                height: 15px;
                margin-top: 20px;
            }
            #tosLabel{
                line-height: 5vh;
                font-size: 2.5vh;
            }
            .genericButton {
                border: none;
                border-radius: 1vh;
                margin-top: 1.5vh;
                padding-left: 20px;
                padding-right: 20px;
                font-family: 'MinecraftTen';
                font-size: 8vw;
                transition: 0.25s;
            }
            .genericButton:hover {
                background-color: #a800a8;
                color: #fcf2ff;
            }
            .section {
                letter-spacing: -0.15vh;
                line-height: 3.5vh;
                width: 95vw;
                font-size: 2.5vh;
            }
            #content{
                padding-left: 2.5vw;
                padding-right: 2.5vw;
            }
            #content > img {
                border-radius: 10px;
                width: 95vw;
            }
            #creditFormat > img {
                margin-left: -7.5vw;
                border-radius: 10px;
                width: 95vw;
            }
            #content > video {
                border-radius: 10px;
                width: 95vw;
            }
            .section > iframe {
                border-radius: 10px;
                width: 95vw;
                height: 50vw;
            }
            .buttonWrapper {
                height: 7.5vh;
            }
            #coffee > div {
                width: 90vw;
                height: 85vh;
                border-radius: 20px;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: white;
                flex-direction: column;
                overflow: hidden;
            }
            #coffee > div > img {
                width: 90vw;
                height: 40vh;
                object-fit: cover;
            }
            #coffee > div > div {
                width: 90vw;
                height: 45vh;
                font-size: 2.75vh;
            }
            #closecoffee {
                top: 9vh;
                right: 9vw;
                width: 7.5vh;
                height: 7.5vh;
                fill: #150857;
            }
        }
    </style>
</head>
<body>
    <dialog id="languageDialog">
        <h3 style="margin: 0; margin-bottom: 5vh;">Choose a supported language</h3>
        <form method="dialog">
            <select class="knowSelect" id="languageSelect">
                <option value="en">English</option>
                <option value="vi">Tiếng Việt</option>
            </select>
            <button>OK!</button>
        </form>
    </dialog>
    <svg viewBox="0 0 375.29 375.29" id="languageSwitcher">
        <path class="cls-1" d="M237.08,202.16l-11.83,22.48h23.66l-11.83-22.48ZM187.64,0C84.01,0,0,84.01,0,187.64s84.01,187.65,187.64,187.65,187.65-84.01,187.65-187.65S291.28,0,187.64,0Zm-30.54,221.99c-4.02,0-8.04-1.56-11.07-4.66l-1.95-1.99c-11.96,13.05-25.35,23.05-39.24,29.15-2.03,.89-4.14,1.31-6.22,1.31-5.97,0-11.65-3.46-14.2-9.27-3.44-7.84,.12-16.98,7.96-20.42,10.83-4.75,21.02-12.95,29.94-23l-24.43-24.95c-5.99-6.12-5.89-15.93,.23-21.92s15.93-5.89,21.92,.23l20.42,20.86c6.91-12.42,11.94-25.52,14.42-37.48H86.19c-8.56,0-15.5-6.94-15.5-15.5s6.94-15.5,15.5-15.5h36.78v-7.27c0-8.57,6.94-15.5,15.5-15.5s15.5,6.93,15.5,15.5v7.27h36.78c8.56,0,15.5,6.94,15.5,15.5s-6.94,15.5-15.5,15.5h-4.39c-2.83,18.48-10.43,38.81-21.78,57.8-.54,.9-1.08,1.79-1.62,2.67l5.22,5.33c5.99,6.11,5.88,15.93-.23,21.92-3.02,2.95-6.94,4.42-10.85,4.42Zm140.77,62.4c-7.57,3.99-16.95,1.08-20.93-6.5l-11.71-22.25h-56.3l-11.71,22.25c-2.78,5.28-8.16,8.29-13.73,8.29-2.44,0-4.9-.58-7.21-1.79-7.57-3.99-10.48-13.36-6.49-20.93l52.94-100.6c2.81-5.34,8.31-8.66,14.35-8.66s11.53,3.32,14.34,8.66l52.95,100.6c3.98,7.57,1.08,16.94-6.5,20.93Zm-72.62-59.75h23.66l-11.83-22.48-11.83,22.48Zm11.83-22.48l-11.83,22.48h23.66l-11.83-22.48Z"/>
    </svg>
    <iframe id="loadingScreen" src="/loading.html" style="position: fixed; width: 100vw; height: 100vh; z-index: 50; background-color: white;"></iframe>
	<div class="topnav" id="myTopnav">
		<video id="hoverVideo" src="/assets/media/rotatingBlock2D.webm" class="hidden" type="video/webm" style="z-index: 40; position: fixed; margin-left: 1vw;" muted loop>BlockState Team</video>
		<div id="fakeLogo">BlockState <br>Team</div>
		<nav id="desktopNav">
			<a href="/project" class="active">Project</a>
			<a href="/announcement">Announcement</a>
			<a href="/contact">Contact</a>
			<a href="/our_story">Our Story</a>
			<a href="/">Home</a>
		</nav>
		<button class="hamburger">
			<div class="bar"></div>
		</button>
		<div class="mobile-nav">
			<a href="/">Home</a>
			<a href="/our_story">Our Story</a>
			<a href="/contact">Contact</a>
			<a href="/announcement">Announcement</a>
			<a href="/project" class="active">Project</a>
		</div>
	</div>
    <div id="coffee">
        <div>
            <img src="/assets/media/coffee.webp">
            <div>
                <h2 style="margin: 0">Support Us?</h2>
                <br>
                We're able to make free Minecraft Add-Ons thanks to your generous donation! If you like our work, please consider supporting us by buying us a coffee!
                <br>
                <button class="genericButton" style="margin: 2vw" onclick="window.open('https://buymeacoffee.com/blues8sbit', '_blank')">Support Now!</button>
            </div>
        </div>
        <svg id="closecoffee" viewBox="0 0 512 512"><path d="M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4  L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1  c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1  c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z"/></svg>
    </div>
    <div id="projectPage">
        <div id="projectPageContent">
            <h2>Our official released projects!</h2>
            <select id="filter" class="knowSelect">
                <option value="latest">Latest</option>
                <option value="oldest">Oldest</option>
                <option value="addon">Add-On</option>
                <option value="map">Map</option>
                <option value="tool">Tool</option>
            </select>
            <div class="container">
            </div>
        </div>
        <div id="projectContent">
        </div>
        <style>
            #commentSectionView {
                display: none;
            }
            #commentForm textarea {
                width: 100%;
                border: 1px solid #ccc;
                border-radius: 5px;
                margin-bottom: 10px;
                resize: none;
                font-family: 'Minecraft';
                font-size: 1.5vw;
            }
            #commentForm {
                width: 80vw;
                display: flex;
                flex-direction: column;
                align-items: right;
            }
            .commentBlock {
                user-select: none;
                width: 80vw;
                height: fit-content;
                display: flex;
                flex-direction: column;
                border: 1px solid #ccc;
                border-radius: 5px;
                padding: 20px;
                padding-top: 0;
                margin-bottom: 10px;
                text-align: left;
                margin-bottom: 10vh;
                background-color: #FCFAFA;
            }
            .avatarHolder {
                margin-top: 5vh;
                height: fit-content;
                display: flex;
            }
            .usernamDisplay {
                font-family: 'Minecraft';
                font-size: 1.8vw;
                font-weight: bolder;
            }
            .usernamDisplay > a {
                text-decoration: none !important;
                color: black;
            }
            .avatarHolder > a > img {
                top: 0;
                height: 10vh;
                width: 10vh;
                border-radius: 5px;
                margin-right: 12px;
            }
        </style>
        <div id="belowSection">
            <h2>HELP SECTION</h2>
            <div class="section">
                If you need any help, feel free to join our Discord!
                <div class="buttonWrapper">
                    <a href="https://discord.gg/p3FvBh2aBd">
                        <button class="genericButton">Discord</button>
                    </a>
                </div>
            </div>
            <h2>DOWNLOAD SECTION</h2>
            <div class="downloadSection">
                <label for="tosCheckbox">
                <input type="checkbox" id="tosCheckbox">
                <span id="tosLabel">I <span style="text-decoration: underline;">disagree</span> to the <a href="/TOS" target="_blank">Term of service</a></span>
                </label><br>
                <button class="genericButton" id="genericButton" disabled>Download Now!</button>
            </div>
            <div id="commentSectionView">
                <h2>COMMENT SECTION</h2>
                <div class="section" style="display: flex; align-items: center; justify-content: center; flex-direction: column;">
                    <div id="otherComments"></div>
                    <div id="commentForm">
                        <textarea id="commentTextArea" rows="4" placeholder="Write your comment here..."></textarea>
                        <button onclick="triggerCommentButton()" class="genericButton" id="loginButton" style="width: 25vw; font-size: 2.5vw;">Login to comment</button>
                    </div>
                </div>
            </div> 
            <div class="compiler">
                <iframe src="/loading.html" style="width: 80vw; height: 95vh; background-color: white; border-radius: 2vw; z-index: 50;"></iframe>
            </div>
            <div id="loadingBar" class="compiler" style="background-color: black; height:20px; width:60vw; margin-left: 20vw; z-index: 51; top: 69vh; display: none;">
                <div id="loadingBarRun" style="background-color: magenta; width:0%; height: inherit; z-index: 52; position: relative; left: 0;"></div>
            </div>
            <div class="compiler" id="loadingText" style="max-width: 90vw; margin-left: 5vw; text-overflow: clip; font-size: 5vw; font-family: 'MinecraftTen'; z-index: 49; margin-top: 28vh; background-color: rgba(0, 0, 0, 0) !important;">
                LOADING...
            </div>
        </div>
    </div>
    <script>
        console.warn('Version 1.0.0');
        let projectData, workingTV, headDecoration, musicExtension;
        const supportedLanguages = ['en', 'vi'];
        let currentLanguage;
        const langCookie = document.cookie.split(';').map(cookie => cookie.trim()).find(cookie => cookie.startsWith('language='));
        if (langCookie) {
            currentLanguage = langCookie ? langCookie.split('=')[1] : null;
        } else {
            currentLanguage = supportedLanguages.includes(navigator.language.substring(0, 2)) ? navigator.language.substring(0, 2) : 'en';
        }
        document.getElementById('languageSwitcher').addEventListener('click', () => {
            document.getElementById('languageDialog').showModal();
            console.log('Language switcher has been clicked');
        });
        document.getElementById('languageDialog').addEventListener('close', () => {
            const selectedLanguage = document.getElementById('languageSelect').value;
            if (currentLanguage !== selectedLanguage) {
                currentLanguage = selectedLanguage;
                console.log('Switching language to', currentLanguage);
                const expires = new Date(Date.now() + 30*24*60*60*1000).toUTCString();
                document.cookie = `language=${currentLanguage};expires=${expires};path=/`;
                reloadPage(currentLanguage);
            } else {
                console.log('Language has not been changed, staying as ', currentLanguage);
            }
        });
        function removeSpecialChars(str) {
            return str.replace(/[<>\/]/g, '');
        }
        function triggerCommentButton() {
            console.log('Triggering comment button');

        }
        async function checkLogin() {
            try {
                const response = await fetch('https://api.blockstate.team/checkLogin', {
                    method: 'GET',
                    credentials: 'include',
                });
                if (response.ok) {
                    const data = await response.json();
                    console.log('Data:', data);
                    document.getElementById("commentSectionView").style.display = 'block'
                    document.getElementById('loginButton').innerText = 'Comment';
                    document.getElementById('commentTextArea').placeholder = 'Comment as ' + data.global_name;
                }
            } catch (error) {
                console.error('Error checking login status:', error);
            }
        }
        async function getProjectList() {
            try {
                const response = await fetch('/projectList.json');
                if (!response.ok) throw new Error(`Failed to fetch data. Status: ${response.status}`);
                const jsonData = await response.json();
                return jsonData;
            } catch (error) {
                console.error('Error fetching project list:', error);
                throw error;
            }
        }
        function showLoadingScreen() {
            const loadingScreen = document.getElementById("loadingScreen");
            loadingScreen.style.opacity = "0";
            loadingScreen.style.visibility = "visible";
        }
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById("loadingScreen");
            loadingScreen.style.opacity = "1";
            setTimeout(() => {
                const fadeOutStep = () => {
                    const currentOpacity = parseFloat(loadingScreen.style.opacity) - (1 / 50);
                    loadingScreen.style.opacity = currentOpacity;

                    if (currentOpacity <= 0) {
                        loadingScreen.style.visibility = "hidden";
                        clearInterval(fadeInterval);
                    }
                };
                const fadeInterval = setInterval(fadeOutStep, 1000 / 50);
            }, 1000);
        }
        window.addEventListener("load", () => {
            hideLoadingScreen()
        });
        window.onload = function () {
            const menu_btn = document.querySelector('.hamburger');
            const mobile_menu = document.querySelector('.mobile-nav');

            menu_btn.addEventListener('click', function () {
                menu_btn.classList.toggle('is-active');
                mobile_menu.classList.toggle('is-active');
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('hoverVideo');
            video.pause();
            video.addEventListener('mouseover', () => {
                video.play();
            });
            video.addEventListener('mouseout', () => {
                video.pause();
                video.currentTime = 0;
            });
        });
        function displayProjectPage(title, projectName, previousLanguage) {
            window.history.pushState({}, document.title, window.location.href);
            window.history.replaceState({}, title, `/projects/${projectName}`);
            reloadPage(previousLanguage);
        }
        window.addEventListener('popstate', () => {
            document.getElementById('projectContent').innerHTML = '';
            reloadPage(currentLanguage);
        });
        function reloadPage(tryLanguage) {
            console.log('Reloading page in', tryLanguage, 'language.');
            window.scrollTo(0, 0);
            let currentUrl = window.location.pathname.replace('.html','');
            if (currentUrl === '/project') {
                console.log(currentUrl, " is the display project page")
                document.getElementById('projectContent').style.display = 'none';
                document.getElementById('projectPageContent').style.display = 'block';
                document.getElementById('projectPage').style.display = 'block';
                document.getElementById('belowSection').style.display = 'none';
                document.title = "Project";
                const container = document.querySelector('.container');
                container.innerHTML = '';
                getProjectList().then(projectList => {
                    projectList.forEach((project, index) => {
                        const div = document.createElement('div');
                        div.classList.add('box');
                        div.dataset.order = index + 1;
                        div.dataset.item = project.dataItem;
                        div.innerHTML = `<a onClick="displayProjectPage('${project.project}', '${project.formatName}', '${tryLanguage}')"><img src="${project.img}"></a>`;
                        container.appendChild(div);
                    });
                }).catch(error => {
                    console.error('Error:', error);
                });
                document.getElementById('filter').addEventListener('change', function () {
                    const selectedValue = filter.value;
                    switch (selectedValue) {
                        case 'latest':
                            sortItem();
                        break;
                        case 'oldest':
                            sortItem(false);
                        break;
                        case 'addon':
                            onlyShow('addon');
                        break;
                        case 'map':
                            onlyShow('map');
                        break;
                        case 'tool':
                            onlyShow('tool');
                        break;
                    }
                });
                const sortItem = (ascending = true) => {
                    const childDivs = Array.from(container.querySelectorAll('div[data-order]'));
                    childDivs.forEach((div) => {
                        div.style.display = '';
                    });
                    childDivs.sort((a, b) => ascending ? a.dataset.order - b.dataset.order : b.dataset.order - a.dataset.order);
                    childDivs.forEach(div => container.appendChild(div));
                };
                function onlyShow(id) {
                    const childDivs = Array.from(container.querySelectorAll('div[data-item]'));
                    childDivs.forEach((div) => {
                        div.style.display = div.dataset.item === id ? '' : 'none';
                    });
                };
            } else if (currentUrl.startsWith('/projects/')) {
                document.getElementById('belowSection').style.display = 'block';
                document.getElementById('projectPage').style.display = 'block';
                document.getElementById('projectContent').style.display = 'block';
                document.getElementById('projectPageContent').style.display = 'none';
                console.log(currentUrl, " is a project page")
                let projectName = currentUrl.replace('/projects/', '');
                console.log('Loading project:', projectName, 'in', tryLanguage, 'language.');
                fetch(`/json/project/${tryLanguage}/${projectName}.json`)
                .then(response => response.ok ? response.json() : Promise.reject(`Failed to fetch data. Status: ${response.status}`))
                .then(data => {
                    projectData = data;
                    if (data.version === "normal") {
                        document.title = data.title;
                        let html ='';
                        html += `
                        <h2>${data.title}</h2>`;
                        if (data.prewarning) {
                            html += `
                            <div class="warning">
                                ${data.prewarning}
                            </div>
                            `;
                        }
                        html += `
                        <div id="content">
                            <div class="section" style="text-align: left;">
                                ${data.introduction}
                            </div>
                        `;
                        for (let i = 0; i < data.content.length; i++) {
                            let elementContent = data.content[i];
                            let alt = elementContent.alt || `An image from the ${projectName.replace('-', '')} project`;
                            if (elementContent.type === 'img') {
                                html += `
                                <img src="/assets/media/${projectName}/${i+1}.webp" alt="${alt}">
                                <div class="section">
                                    ${elementContent.text}
                                </div>`
                            } else if (elementContent.type === 'video') {
                                html += `
                                <video disableRemotePlayback loop muted autoplay>
                                    <source src="/assets/media/${projectName}/${i+1}.webm" type="video/webm">
                                </video>
                                <div class="section">
                                    ${elementContent.text}
                                </div>`
                            } else if (elementContent.type === 'youtube') {
                                html += `
                                <div class="section">
                                    ${elementContent.text}<br>
                                    ${elementContent.iframe}
                                </div>
                                `
                            } else if (elementContent.type === 'iframe') {
                                html += `
                                <div class="section">
                                    ${elementContent.text}<br>
                                    ${elementContent.iframe}
                                </div>`
                            }
                        }
                        html += `</div>`;
                        if (data.credit) {
                            console.log('Credit section is available');
                            html += `
                            <h2>CREDIT SECTION</h2>
                            <div class="section" id="creditFormat">
                                ${data.credit}
                            </div>
                            `
                        };
                        if (data.customizable) {
                            html += '<style>'
                            for (let i = 0; i < data.customizable.style.length; i++) {
                                html += data.customizable.style[i];
                            }
                            html += '</style>'
                            html += `
                            <h2>CUSTOMIZATION SECTION</h2>
                            ${data.customizable.content}
                            `
                            if (data.downloadLink === 'module-working-tv') {
                                initializeWorkingTV();
                            } else if (data.downloadLink === 'module-head-decoration') {
                                initializeHeadDecoration();
                            } else if (data.downloadLink === 'module-music-extension') {
                                initializeMusicExtension();
                            }
                        };
                        if (data.postwarning) {
                            html += `
                            <div class="warning">
                                ${data.postwarning}
                            </div>`
                        };
                        document.getElementById('projectContent').innerHTML = html;
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error.message);
                    reloadPage('en')
                });
                getProjectList().then(projectList => {
                    projectList.forEach((project, index) => {
                        if (project.formatName === projectName) {
                            const projectIndexComment = projectList.length - index - 1;
                            fetch(`https://script.google.com/macros/s/AKfycbyqQ1PhEBBgumf9uIe6qbhv07YurxQUlwvxkHx3Duavth8-OJRuCyt-tI2E1HnF2_wA/exec?projectIndex=` + projectIndexComment)
                            .then(response => response.ok ? response.json() : Promise.reject(`Failed to fetch data. Status: ${response.status}`))
                            .then(jsonData => {
                                if (jsonData.projectIndex === projectIndexComment) {
                                    const commentDiv = document.createElement('div');
                                    commentDiv.classList.add('commentBlock');
                                    jsonData.data.forEach(comment => {
                                        if (comment.userId.length > 0) {
                                            let commentDataArray = comment.userId.split(';');
                                            let userDiscordLink = "https://discordapp.com/users/" + commentDataArray[2];
                                            commentDiv.innerHTML += `
                                            <div class="avatarHolder">
                                                <a href="${userDiscordLink}"><img src="data:image/png;base64,${commentDataArray[0]}"></a>
                                                <div><div class="usernamDisplay"><a href="${userDiscordLink}">${commentDataArray[1]}</a></div>${removeSpecialChars(comment.comment)}</div>
                                            </div>
                                            `;
                                        }
                                    });
                                    document.getElementById('otherComments').appendChild(commentDiv);
                                } else {
                                    console.warn('Data is not matched');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        }
                    });
                }).catch(error => {
                    console.error('Error:', error);
                });
                setTimeout(() => {
                    checkLogin();
                }, 1000);
            } else {
                console.log(currentUrl, " is a 404 page");
                window.location.href = '/403.html';
            }
        }
        async function initializeWorkingTV() {
            try {
                workingTV = await import('/module/working-tv.js');
                console.log('working-tv.js module has been loaded');
                workingTV.setupEventListeners();
                console.log('Event listeners have been set up');
            } catch (error) {
                console.error('Error loading the working-tv module:', error);
            }
        }
        async function initializeMusicExtension() {
            try {
                musicExtension = await import('/module/music-extension.js');
                console.log('music-extension.js module has been loaded');
            } catch (error) {
                console.error('Error loading the working-tv module:', error);
            }
        }
        async function initializeHeadDecoration() {
            try {
                headDecoration = await import('/module/head-decoration.js');
                console.log('head-decoration.js module has been loaded');
                document.cookie.split('; ').forEach(cookie => {
                    const [cookieName, cookieValue] = cookie.split('=');
                    if (cookieName && cookieValue) {
                        const [name, css] = cookieValue.split('-');
                        if (name && css) headDecoration.handleButtonClick(name, cookieName, css, false);
                    }
                });
            } catch (error) {
                console.error('Error loading the head-decoration module:', error);
            }
        }
        reloadPage(currentLanguage);
        const tosCheckbox = document.getElementById('tosCheckbox');
        const downloadButton = document.getElementById('genericButton');
        tosCheckbox.addEventListener('change', () => {
        if (tosCheckbox.checked) {
            downloadButton.removeAttribute('disabled');
            tosLabel.innerHTML = 'I agree to the <a href="/TOS" target="_blank">Term of service</a>';
        } else {
            downloadButton.setAttribute('disabled', 'disabled');
            tosLabel.innerHTML = 'I <span style="text-decoration: underline;">disagree</span> to the <a href="/TOS" target="_blank">Term of service</a>';
        }
        });
        downloadButton.addEventListener('click', () => {
            console.log(projectData);
            if (!tosCheckbox.checked) {
                alert('Please agree to the Terms of Service (TOS) before downloading.');
                return;
            }
            fetch('https://api.ipify.org/')
            .then(r => r.ok ? r.text() : Promise.reject('Network response was not ok'))
            .catch(e => ('undefined', console.error('Error:', e)))
            .then(fetchedData => {
                let formData = new FormData();
                formData.append("entry.606279263", fetchedData);
                formData.append("entry.1080269179", projectData.title.replace('Project: ', ''));
                formData.append("entry.826374623", Date.now());

                return fetch("https://docs.google.com/forms/d/e/1FAIpQLSfiIG0fLLNucnSzChPm9F2gWqkk9GOhUHGHUlYT-k3h-FBRFA/formResponse", { method: "POST", body: formData, mode: "no-cors" });
            })
            .then(() => console.log("Form submitted successfully"))
            .catch(error => console.error("Error:", error));
            document.getElementById('coffee').style.display = 'flex';
            document.getElementById('closecoffee').addEventListener('click', () => {
                console.log(projectData);
                document.getElementById('coffee').style.display = 'none';
                if (projectData.downloadLink === 'module-working-tv') {
                    workingTV.initializeDownload();
                } else if (projectData.downloadLink === 'module-head-decoration') {
                    headDecoration.initializeDownload();
                } else if (projectData.downloadLink === 'module-music-extension') {
                    musicExtension.initializeDownload();
                } else if (typeof projectData.downloadLink !== 'undefined') {
                    window.location.href = projectData.downloadLink;
                } else {
                    console.error("Something gone wrong")
                }
            });
        });
    </script>
</body>
</html>